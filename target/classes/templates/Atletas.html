<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atletas - Fut360</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" th:href="@{/css/atletas_style.css}">
</head>
<body>
<div class="dashboard-container">
    <aside class="sidebar">
        <div class="sidebar-header">
            <img th:src="@{/images/logo_fut_360.png}" alt="Logo Fut360" class="sidebar-logo">
            <h1 class="sidebar-title">Fut360</h1>
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li><a th:href="@{/dashboard}"><i class='bx bxs-dashboard'></i><span>Dashboard</span></a></li>
                <li><a th:href="@{/financeiro}"><i class='bx bx-dollar-circle'></i><span>Financeiro</span></a></li>
                <li><a th:href="@{/calendario}"><i class='bx bx-calendar'></i><span>Calendário</span></a></li>
                <li class="active"><a th:href="@{/atletas}"><i class='bx bx-run'></i><span>Atletas</span></a></li>
                <li><a th:href="@{/relatorios}"><i class='bx bxs-report'></i><span>Relatórios</span></a></li>
            </ul>
        </nav>
    </aside>

    <main class="main-content">
        <header class="header">
            <div class="header-title"><h2>Gestão de Atletas</h2><p>Elenco Profissional</p></div>
            <div class="user-info">
                <span>Kauê Farias</span>
                <div class="user-avatar">K</div>

                <a th:href="@{/logout}" title="Sair" style="cursor: pointer; color: white; font-size: 24px; text-decoration: none; margin-left: 15px; z-index: 999;">
                    <i class='bx bx-log-out'></i>
                </a>
            </div>
        </header>

        <div class="controls-bar">
            <div class="search-filter-group">
                <div class="search-bar"><i class='bx bx-search'></i><input type="text" id="search-input" placeholder="Buscar atleta..."></div>
                <select id="category-filter"><option value="all">Todas Categorias</option><option value="Profissional">Profissional</option><option value="Sub-20">Sub-20</option></select>
                <select id="position-filter"><option value="all">Todas Posições</option><option value="Goleiro">Goleiro</option><option value="Zagueiro">Zagueiro</option><option value="Meio-Campo">Meio-Campo</option><option value="Atacante">Atacante</option></select>
            </div>
            <button class="btn-primary" id="add-athlete-btn"><i class='bx bx-plus'></i> Adicionar Atleta</button>
        </div>

        <section class="athlete-grid" th:unless="${#lists.isEmpty(atletas)}">
            <div class="athlete-card" th:each="atleta : ${atletas}"
                 th:data-id="${atleta.id}"
                 th:data-name="${atleta.name}"
                 th:data-position="${atleta.posicao}"
                 th:data-category="${atleta.categoria}"
                 th:data-photo="@{/uploads/{filename}(filename=${atleta.photo})}"
                 th:data-fullname="${atleta.fullname}"
                 th:data-birthdate="${atleta.birthdate != null ? #temporals.format(atleta.birthdate, 'dd/MM/yyyy') : 'N/A'}"
                 th:data-age="${atleta.getAge()}"
                 th:data-nationality="${atleta.nacionalidade}"
                 th:data-height="${atleta.alturaCm != null ? atleta.alturaCm + ' cm' : ''}"
                 th:data-weight="${atleta.pesoKg != null ? atleta.pesoKg + ' kg' : ''}"
                 th:data-foot="${atleta.foot}"

                 th:data-salary="${!atleta.contratos.isEmpty() ? #numbers.formatCurrency(atleta.contratos[0].salario) : 'N/A'}"
                 th:data-release-clause="${!atleta.contratos.isEmpty() ? #numbers.formatCurrency(atleta.contratos[0].releaseClause) : 'N/A'}"
                 th:data-contract-start="${!atleta.contratos.isEmpty() ? atleta.contratos[0].contractStart : 'N/A'}"
                 th:data-contract-end="${!atleta.contratos.isEmpty() ? atleta.contratos[0].contractEnd : 'N/A'}"

                 th:data-stats-id="${!atleta.estatisticas.isEmpty() ? atleta.estatisticas[0].id : ''}"
                 th:data-games="${!atleta.estatisticas.isEmpty() ? atleta.estatisticas[0].games : 0}"
                 th:data-minutes="${!atleta.estatisticas.isEmpty() ? atleta.estatisticas[0].minutes : 0}"
                 th:data-goals="${!atleta.estatisticas.isEmpty() ? atleta.estatisticas[0].goals : 0}"
                 th:data-assists="${!atleta.estatisticas.isEmpty() ? atleta.estatisticas[0].assists : 0}"
                 th:data-yellow="${!atleta.estatisticas.isEmpty() ? atleta.estatisticas[0].yellow : 0}"
                 th:data-red="${!atleta.estatisticas.isEmpty() ? atleta.estatisticas[0].red : 0}"

                 th:data-treino-id="${!atleta.treinos.isEmpty() ? atleta.treinos[0].id : ''}"
                 th:data-treino-nota-geral="${!atleta.treinos.isEmpty() ? atleta.treinos[0].getTreinoNotaGeral() : 0}"
                 th:data-treino-nota-tatica="${!atleta.treinos.isEmpty() ? atleta.treinos[0].treinoNotaTatica : 0}"
                 th:data-treino-nota-tecnica="${!atleta.treinos.isEmpty() ? atleta.treinos[0].getTreinoNotaTecnica() : 0}"
                 th:data-treino-nota-fisica="${!atleta.treinos.isEmpty() ? atleta.treinos[0].treinoNotaFisica : 0}"
                 th:data-treino-passes-certos="${!atleta.treinos.isEmpty() ? atleta.treinos[0].treinoPassesCertos : 0}"
                 th:data-treino-passes-total="${!atleta.treinos.isEmpty() ? atleta.treinos[0].treinoPassesTotal : 0}"
                 th:data-treino-chutes-certos="${!atleta.treinos.isEmpty() ? atleta.treinos[0].treinoChutesCertos : 0}"
                 th:data-treino-chutes-total="${!atleta.treinos.isEmpty() ? atleta.treinos[0].treinoChutesTotal : 0}"
                 th:data-treino-dribles-certos="${!atleta.treinos.isEmpty() ? atleta.treinos[0].treinoDriblesCertos : 0}"
                 th:data-treino-dribles-total="${!atleta.treinos.isEmpty() ? atleta.treinos[0].treinoDriblesTotal : 0}"
                 th:data-treino-desarmes="${!atleta.treinos.isEmpty() ? atleta.treinos[0].treinoDesarmes : 0}"
                 th:data-treino-interceptacoes="${!atleta.treinos.isEmpty() ? atleta.treinos[0].treinoInterceptacoes : 0}"
                 th:data-treino-km-percorridos="${!atleta.treinos.isEmpty() ? atleta.treinos[0].treinoKmPercorridos : 0}"
                 th:data-treino-vel-max="${!atleta.treinos.isEmpty() ? atleta.treinos[0].treinoVelocidadeMax : 0}"
                 th:data-treino-sprints="${!atleta.treinos.isEmpty() ? atleta.treinos[0].treinoSprints : 0}"

                 th:data-meta1="${!atleta.registros.isEmpty() ? atleta.registros[0].descricao : 'Nenhuma meta.'}"
                 th:data-meta2="${!atleta.registros.isEmpty() && atleta.registros.size() > 1 ? atleta.registros[1].descricao : ''}"
                 th:data-observation="${!atleta.registros.isEmpty() && atleta.registros.size() > 2 ? atleta.registros[2].descricao : 'Sem observações.'}">

                <img th:src="@{/uploads/{filename}(filename=${atleta.photo})}" class="athlete-photo">
                <h3 class="athlete-name" th:text="${atleta.name}"></h3>
                <p class="athlete-info" th:text="${atleta.posicao}"></p>
                <span class="athlete-category" th:text="${atleta.categoria}"></span>
            </div>
        </section>
    </main>
</div>

<div id="athlete-modal" class="modal-overlay">
    <div class="modal-content">
        <button class="close-button" id="close-modal-btn">&times;</button>
        <div class="modal-left">
            <img src="" id="modal-photo" class="modal-photo">
            <h2 id="modal-name" class="modal-name"></h2>
            <p id="modal-position" class="modal-position"></p>
        </div>
        <div class="modal-right">
            <div class="modal-tabs">
                <button class="tab-link active" data-tab="ficha-tecnica">Ficha</button>
                <button class="tab-link" data-tab="desempenho">Desempenho</button>
                <button class="tab-link" data-tab="carreira-metas">Carreira</button>
                <button class="tab-link" data-tab="financeiro">Financeiro</button>
            </div>

            <div id="ficha-tecnica" class="tab-content active">
                <div class="info-grid">
                    <div class="info-item"><label>Nome</label><p id="modal-fullname"></p></div>
                    <div class="info-item"><label>Nascimento</label><p id="modal-birthdate"></p></div>
                    <div class="info-item"><label>Idade</label><p id="modal-age"></p></div>
                    <div class="info-item"><label>Nacionalidade</label><p id="modal-nationality"></p></div>
                    <div class="info-item"><label>Altura</label><p id="modal-height"></p></div>
                    <div class="info-item"><label>Peso</label><p id="modal-weight"></p></div>
                    <div class="info-item"><label>Pé</label><p id="modal-foot"></p></div>
                </div>
            </div>

            <div id="desempenho" class="tab-content">
                <div class="controls-bar" style="margin-bottom: 20px;">
                    <h3 class="info-section-title" style="margin: 0; border: none;">Último Treino</h3>
                    <button class="btn-primary" id="show-add-treino-modal-btn"><i class='bx bx-edit-alt'></i> Atualizar</button>
                </div>
                <div class="info-grid">
                    <div class="main-rating-box"><label>Nota Geral</label><p><span class="rating-badge" id="modal-treino-nota-geral">0.0</span></p></div>
                    <div class="sub-rating-grid">
                        <div class="sub-rating-box"><label>Tática</label><p id="modal-treino-nota-tatica"></p></div>
                        <div class="sub-rating-box"><label>Técnica</label><p id="modal-treino-nota-tecnica"></p></div>
                        <div class="sub-rating-box"><label>Física</label><p id="modal-treino-nota-fisica"></p></div>
                    </div>
                    <div class="info-item-full stats-list"><div class="stat-item"><span class="stat-item-label">Passes</span><span class="stat-item-value" id="modal-treino-passes"></span></div><div class="stat-bar-container"><div class="stat-bar-fill" id="modal-treino-passes-bar"></div></div></div>
                    <div class="info-item-full stats-list"><div class="stat-item"><span class="stat-item-label">Chutes</span><span class="stat-item-value" id="modal-treino-chutes"></span></div><div class="stat-bar-container"><div class="stat-bar-fill" id="modal-treino-chutes-bar"></div></div></div>
                    <div class="info-item-full stats-list"><div class="stat-item"><span class="stat-item-label">Dribles</span><span class="stat-item-value" id="modal-treino-dribles"></span></div><div class="stat-bar-container"><div class="stat-bar-fill" id="modal-treino-dribles-bar"></div></div></div>
                    <div class="info-grid">
                        <div class="info-item"><label>Desarmes</label><p id="modal-treino-desarmes"></p></div>
                        <div class="info-item"><label>Intercept.</label><p id="modal-treino-interceptacoes"></p></div>
                        <div class="info-item"><label>Distância</label><p id="modal-treino-km"></p></div>
                        <div class="info-item"><label>Vel. Máx</label><p id="modal-treino-vel-max"></p></div>
                        <div class="info-item"><label>Sprints</label><p id="modal-treino-sprints"></p></div>
                    </div>
                </div>

                <div class="controls-bar" style="margin-top: 30px; margin-bottom: 20px;">
                    <h3 class="info-section-title" style="margin: 0; border: none;">Temporada</h3>
                    <button class="btn-primary" style="font-size: 11px; padding: 5px 10px;" id="show-add-stats-modal-btn">Atualizar</button>
                </div>
                <div class="info-grid">
                    <div class="info-item"><label>Jogos</label><p id="modal-games"></p></div>
                    <div class="info-item"><label>Gols</label><p id="modal-goals"></p></div>
                    <div class="info-item"><label>Assist.</label><p id="modal-assists"></p></div>
                    <div class="info-item"><label>Minutos</label><p id="modal-minutes"></p></div>
                    <div class="info-item"><label>Amarelos</label><p id="modal-yellow"></p></div>
                    <div class="info-item"><label>Vermelhos</label><p id="modal-red"></p></div>
                </div>
            </div>

            <div id="carreira-metas" class="tab-content">
                <h3 class="info-section-title">Metas da Temporada</h3>
                <ul class="goals-list"><li id="modal-meta-1"></li><li id="modal-meta-2"></li></ul>
                <h3 class="info-section-title" style="margin-top: 20px;">Observação</h3>
                <div class="observation-log"><blockquote id="modal-observation"></blockquote><span>Registrado por: Equipe Técnica</span></div>
            </div>
            <div id="financeiro" class="tab-content">
                <div class="info-grid">
                    <div class="info-item"><label>Salário</label><p id="modal-salary"></p></div>
                    <div class="info-item info-item-full"><label>Multa</label><p id="modal-release-clause"></p></div>
                    <div class="info-item"><label>Início</label><p id="modal-contract-start"></p></div>
                    <div class="info-item"><label>Fim</label><p id="modal-contract-end"></p></div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="add-athlete-modal" class="modal-overlay">
    <div class="modal-content" style="max-width: 700px; display: block;">
        <button class="close-button" id="close-add-modal-btn">&times;</button>
        <h2 class="info-section-title" style="text-align: center;">Novo Atleta</h2>
        <form th:action="@{/atletas/salvar}" method="post" enctype="multipart/form-data" class="modal-form-body">
            <div class="modal-left" style="margin: 0 auto 20px; width: 100%;"><div class="info-item" style="text-align: center;"><label>Foto</label><input type="file" name="imageFile" accept="image/png, image/jpeg"></div></div>
            <div class="modal-tabs" style="justify-content: center;"><button class="tab-link active" type="button" data-tab="add-ficha">Ficha</button><button class="tab-link" type="button" data-tab="add-contrato">Contrato</button></div>
            <div id="add-ficha" class="tab-content active">
                <div class="form-group"><label>Nome Completo</label><input type="text" th:field="${atletaNovo.fullname}"></div>
                <div class="form-grid-2">
                    <div class="form-group"><label>Nome Curto</label><input type="text" th:field="${atletaNovo.name}"></div>
                    <div class="form-group"><label>Nascimento</label><input type="date" th:field="${atletaNovo.birthdate}"></div>
                </div>
                <div class="form-grid-3">
                    <div class="form-group"><label>Nacionalidade</label><input type="text" th:field="${atletaNovo.nacionalidade}"></div>
                    <div class="form-group"><label>Altura (cm)</label><input type="number" th:field="${atletaNovo.alturaCm}"></div>
                    <div class="form-group"><label>Peso (kg)</label><input type="number" step="0.1" th:field="${atletaNovo.pesoKg}"></div>
                </div>
                <div class="form-grid-3">
                    <div class="form-group"><label>Pé</label><select th:field="${atletaNovo.foot}"><option value="Destro">Destro</option><option value="Canhoto">Canhoto</option></select></div>
                    <div class="form-group"><label>Posição</label><select th:field="${atletaNovo.posicao}"><option value="Atacante">Atacante</option><option value="Meio">Meio</option><option value="Zagueiro">Zagueiro</option><option value="Goleiro">Goleiro</option></select></div>
                    <div class="form-group"><label>Categoria</label><select th:field="${atletaNovo.categoria}"><option value="Profissional">Profissional</option><option value="Sub-20">Sub-20</option></select></div>
                </div>
            </div>
            <div id="add-contrato" class="tab-content">
                <div class="form-grid-2">
                    <div class="form-group"><label>Salário</label><input type="number" step="0.01" th:field="${contratoNovo.salario}"></div>
                    <div class="form-group"><label>Multa</label><input type="number" step="0.01" th:field="${contratoNovo.releaseClause}"></div>
                    <div class="form-group"><label>Início</label><input type="date" th:field="${contratoNovo.contractStart}"></div>
                    <div class="form-group"><label>Fim</label><input type="date" th:field="${contratoNovo.contractEnd}"></div>
                </div>
            </div>
            <div class="form-actions"><button type="submit" class="btn-primary">Salvar</button></div>
        </form>
    </div>
</div>

<div id="add-treino-modal" class="modal-overlay">
    <div class="modal-content" style="max-width: 700px; display: block;">
        <button class="close-button" id="close-add-treino-modal-btn">&times;</button>
        <h2 class="info-section-title" style="text-align: center;">Atualizar/Novo Treino</h2>
        <form th:action="@{/treino/salvar}" method="post" class="modal-form-body">
            <input type="hidden" id="form-treino-id" name="id" />
            <input type="hidden" id="treino-atleta-id" name="atletaId" />
            <h3 class="form-section-title">Notas</h3>
            <div class="form-grid-2">
                <div class="form-group"><label>Tática</label><input type="number" step="0.1" id="input-treino-tatica" name="treinoNotaTatica"></div>
                <div class="form-group"><label>Física</label><input type="number" step="0.1" id="input-treino-fisica" name="treinoNotaFisica"></div>
            </div>
            <h3 class="form-section-title">Estatísticas</h3>
            <div class="form-grid-3">
                <div class="form-group"><label>Passes Certos</label><input type="number" id="input-treino-passes-c" name="treinoPassesCertos"></div>
                <div class="form-group"><label>Passes Total</label><input type="number" id="input-treino-passes-t" name="treinoPassesTotal"></div>
                <div class="form-group"><label>Chutes Certos</label><input type="number" id="input-treino-chutes-c" name="treinoChutesCertos"></div>
                <div class="form-group"><label>Chutes Total</label><input type="number" id="input-treino-chutes-t" name="treinoChutesTotal"></div>
                <div class="form-group"><label>Dribles Certos</label><input type="number" id="input-treino-dribles-c" name="treinoDriblesCertos"></div>
                <div class="form-group"><label>Dribles Total</label><input type="number" id="input-treino-dribles-t" name="treinoDriblesTotal"></div>
                <div class="form-group"><label>Desarmes</label><input type="number" id="input-treino-desarmes" name="treinoDesarmes"></div>
                <div class="form-group"><label>Interceptações</label><input type="number" id="input-treino-interceptacoes" name="treinoInterceptacoes"></div>
            </div>
            <h3 class="form-section-title">GPS</h3>
            <div class="form-grid-3">
                <div class="form-group"><label>Dist. (km)</label><input type="number" step="0.1" id="input-treino-km" name="treinoKmPercorridos"></div>
                <div class="form-group"><label>Vel. Max</label><input type="number" step="0.1" id="input-treino-vel" name="treinoVelocidadeMax"></div>
                <div class="form-group"><label>Sprints</label><input type="number" id="input-treino-sprints" name="treinoSprints"></div>
            </div>
            <div class="form-actions"><button type="submit" class="btn-primary">Salvar</button></div>
        </form>
    </div>
</div>

<div id="add-stats-modal" class="modal-overlay">
    <div class="modal-content" style="max-width: 700px; display: block;">
        <button class="close-button" id="close-add-stats-modal-btn">&times;</button>
        <h2 class="info-section-title" style="text-align: center;">Atualizar Stats</h2>
        <form th:action="@{/estatisticas/salvar}" method="post" class="modal-form-body">
            <input type="hidden" id="stats-atleta-id" name="atletaId" />
            <input type="hidden" id="stats-id" name="id" />
            <div class="form-group"><label>Temporada</label><input type="text" id="input-stats-temp" name="temporada" placeholder="2025"></div>
            <div class="form-grid-3">
                <div class="form-group"><label>Jogos</label><input type="number" id="input-stats-jogos" name="games"></div>
                <div class="form-group"><label>Gols</label><input type="number" id="input-stats-gols" name="goals"></div>
                <div class="form-group"><label>Assist.</label><input type="number" id="input-stats-assists" name="assists"></div>
                <div class="form-group"><label>Minutos</label><input type="number" id="input-stats-min" name="minutes"></div>
                <div class="form-group"><label>Amarelos</label><input type="number" id="input-stats-y" name="yellow"></div>
                <div class="form-group"><label>Vermelhos</label><input type="number" id="input-stats-r" name="red"></div>
            </div>
            <div class="form-actions"><button type="submit" class="btn-primary">Salvar</button></div>
        </form>
    </div>
</div>

<script th:src="@{/js/atletas.js}"></script>
</body>
</html>